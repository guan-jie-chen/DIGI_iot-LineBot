<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/module/Button.js - webduino-js</title>
    <link rel="stylesheet" href="">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/css/lucid.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-skin-sam">
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <h1 class="brand" style="padding: 10px 16px 10px; height: 20px; line-height: 20px; margin-left: 0;">
            webduino-js
        </h1>
	<div class="nav">
            <li class="divider-vertical"></li>
            <li>
                <p class="navbar-text">
                    API Docs for Version: <b>0.4.20</b>
                </p>
            </li>
        </div>
        <form class="navbar-form pull-right" style="line-height: 40px; height: 40px;">
            <input style="margin-top: 0;" type="text" class="search-query" placeholder="Search for classes/modules..." data-obj='["classes/webduino.Board", "classes/webduino.EventEmitter", "classes/webduino.Module", "classes/webduino.module.ADXL345", "classes/webduino.module.Barcode", "classes/webduino.module.Button", "classes/webduino.module.Buzzer", "classes/webduino.module.Dht", "classes/webduino.module.HX711", "classes/webduino.module.IRLed", "classes/webduino.module.IRRecv", "classes/webduino.module.Led", "classes/webduino.module.Max7219", "classes/webduino.module.Photocell", "classes/webduino.module.RFID", "classes/webduino.module.RGBLed", "classes/webduino.module.Soil", "classes/webduino.module.Ultrasonic", "classes/webduino.Transport", "classes/webduino.transport.MqttTransport", "classes/webduino.transport.NodeMqttTransport"]'>
        </form>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="span3">
<div>
    <div id="sidebar">
    <div id="classes">
        <ul id="api-classes" class="nav nav-list">
                <li><a href="../classes/webduino.Board.html">webduino.Board</a></li>
                <li><a href="../classes/webduino.EventEmitter.html">webduino.EventEmitter</a></li>
                <li><a href="../classes/webduino.Module.html">webduino.Module</a></li>
                <li><a href="../classes/webduino.module.ADXL345.html">webduino.module.ADXL345</a></li>
                <li><a href="../classes/webduino.module.Barcode.html">webduino.module.Barcode</a></li>
                <li><a href="../classes/webduino.module.Button.html">webduino.module.Button</a></li>
                <li><a href="../classes/webduino.module.Buzzer.html">webduino.module.Buzzer</a></li>
                <li><a href="../classes/webduino.module.Dht.html">webduino.module.Dht</a></li>
                <li><a href="../classes/webduino.module.HX711.html">webduino.module.HX711</a></li>
                <li><a href="../classes/webduino.module.IRLed.html">webduino.module.IRLed</a></li>
                <li><a href="../classes/webduino.module.IRRecv.html">webduino.module.IRRecv</a></li>
                <li><a href="../classes/webduino.module.Led.html">webduino.module.Led</a></li>
                <li><a href="../classes/webduino.module.Max7219.html">webduino.module.Max7219</a></li>
                <li><a href="../classes/webduino.module.Photocell.html">webduino.module.Photocell</a></li>
                <li><a href="../classes/webduino.module.RFID.html">webduino.module.RFID</a></li>
                <li><a href="../classes/webduino.module.RGBLed.html">webduino.module.RGBLed</a></li>
                <li><a href="../classes/webduino.module.Soil.html">webduino.module.Soil</a></li>
                <li><a href="../classes/webduino.module.Ultrasonic.html">webduino.module.Ultrasonic</a></li>
                <li><a href="../classes/webduino.Transport.html">webduino.Transport</a></li>
                <li><a href="../classes/webduino.transport.MqttTransport.html">webduino.transport.MqttTransport</a></li>
                <li><a href="../classes/webduino.transport.NodeMqttTransport.html">webduino.transport.NodeMqttTransport</a></li>
        </ul>
    </div>
    </div>
</div>
        </div>
        <div class="span9">
    <form id="options-form" class="form-inline pull-right">
        Show:
        <label for="api-show-inherited" class="checkbox">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected" class="checkbox">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private" class="checkbox">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated" class="checkbox">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </form>

            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<div class="page-header">
    <h1>src/module/Button.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums">
+(function (global, factory) {
  if (typeof exports === &#x27;undefined&#x27;) {
    factory(global.webduino || {});
  } else {
    module.exports = factory;
  }
}(this, function (scope) {
  &#x27;use strict&#x27;;

  var PinEvent = scope.PinEvent,
    Pin = scope.Pin,
    Module = scope.Module;

  var ButtonEvent = {

    /**
     * Fires when a button is pressed.
     *
     * @event ButtonEvent.PRESS
     */
    PRESS: &#x27;pressed&#x27;,

    /**
     * Fires when a button is released.
     *
     * @event ButtonEvent.RELEASE
     */
    RELEASE: &#x27;released&#x27;,

    /**
     * Fires when a button is long-pressed.
     *
     * @event ButtonEvent.LONG_PRESS
     */
    LONG_PRESS: &#x27;longPress&#x27;,

    /**
     * Fires when a button is sustained-pressed.
     *
     * @event ButtonEvent.SUSTAINED_PRESS
     */
    SUSTAINED_PRESS: &#x27;sustainedPress&#x27;
  };

  /**
   * The Button Class.
   *
   * @namespace webduino.module
   * @class Button
   * @constructor
   * @param {webduino.Board} board The board the button is attached to.
   * @param {webduino.pin} pin The pin the button is connected to.
   * @param {Number} [buttonMode] Type of resistor the button is connected to, either Button.PULL_DOWN or Button.PULL_UP.
   * @param {Number} [sustainedPressInterval] A period of time when the button is pressed and hold for that long, it would be considered a &quot;sustained press.&quot; Measured in ms.
   * @extends webduino.Module
   */
  function Button(board, pin, buttonMode, sustainedPressInterval) {
    Module.call(this);

    this._board = board;
    this._pin = pin;
    this._repeatCount = 0;
    this._timer = null;
    this._timeout = null;

    this._buttonMode = buttonMode || Button.PULL_DOWN;
    this._sustainedPressInterval = sustainedPressInterval || 1000;
    this._debounceInterval = 20;
    this._pressHandler = onPress.bind(this);
    this._releaseHandler = onRelease.bind(this);
    this._sustainedPressHandler = onSustainedPress.bind(this);

    board.setDigitalPinMode(pin.number, Pin.DIN);

    if (this._buttonMode === Button.INTERNAL_PULL_UP) {
      board.enablePullUp(pin.number);
      this._pin.value = Pin.HIGH;
    } else if (this._buttonMode === Button.PULL_UP) {
      this._pin.value = Pin.HIGH;
    }

    this._pin.on(PinEvent.CHANGE, onPinChange.bind(this));
  }

  function onPinChange(pin) {
    var btnVal = pin.value;
    var stateHandler;

    if (this._buttonMode === Button.PULL_DOWN) {
      if (btnVal === 1) {
        stateHandler = this._pressHandler;
      } else {
        stateHandler = this._releaseHandler;
      }
    } else if (this._buttonMode === Button.PULL_UP || this._buttonMode === Button.INTERNAL_PULL_UP) {
      if (btnVal === 1) {
        stateHandler = this._releaseHandler;
      } else {
        stateHandler = this._pressHandler;
      }
    }

    if (this._timeout) {
      clearTimeout(this._timeout);
    }
    this._timeout = setTimeout(stateHandler, this._debounceInterval);
  }

  function onPress() {
    this.emit(ButtonEvent.PRESS);
    if (this._timer) {
      clearInterval(this._timer);
      delete this._timer;
    }
    this._timer = setInterval(this._sustainedPressHandler, this._sustainedPressInterval);
  }

  function onRelease() {
    this.emit(ButtonEvent.RELEASE);
    if (this._timer) {
      clearInterval(this._timer);
      delete this._timer;
    }
    this._repeatCount = 0;
  }

  function onSustainedPress() {
    if (this._repeatCount &gt; 0) {
      this.emit(ButtonEvent.SUSTAINED_PRESS);
    } else {
      this.emit(ButtonEvent.LONG_PRESS);
    }
    this._repeatCount++;
  }

  Button.prototype = Object.create(Module.prototype, {

    constructor: {
      value: Button
    },

    /**
     * Return the button mode.
     *
     * @attribute buttonMode
     * @type {Number} buttonMode
     * @readOnly
     */
    buttonMode: {
      get: function () {
        return this._buttonMode;
      }
    },

    /**
     * Return the sustained-press interval.
     *
     * @attribute sustainedPressInterval
     * @type {Number}
     */
    sustainedPressInterval: {
      get: function () {
        return this._sustainedPressInterval;
      },
      set: function (intervalTime) {
        this._sustainedPressInterval = intervalTime;
      }
    }

  });

  /**
   * Indicates the pull-down resistor type.
   * 
   * @property PULL_DOWN
   * @type {Number}
   * @static
   * @final
   */
  Button.PULL_DOWN = 0;

  /**
   * Indicates the pull-up resistor type.
   * 
   * @property PULL_UP
   * @type {Number}
   * @static
   * @final
   */
  Button.PULL_UP = 1;

  /**
   * Indicates the internal-pull-up resistor type.
   * 
   * @property INTERNAL_PULL_UP
   * @type {Number}
   * @static
   * @final
   */
  Button.INTERNAL_PULL_UP = 2;

  scope.module.ButtonEvent = ButtonEvent;
  scope.module.Button = Button;
}));

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/yuidoc-bootstrap.js"></script>
<script>prettyPrint();</script>
</body>
</html>
